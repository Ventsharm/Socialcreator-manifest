<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Ventsharm Budget</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#000000">
  <link rel="icon" href="Icon-192.png">

  <style>
    body{font-family:system-ui,sans-serif;background:#f5f6f8;display:flex;flex-direction:column;align-items:center;padding:30px 10px;color:#222}
    .app{background:#fff;border-radius:20px;box-shadow:0 4px 20px rgba(0,0,0,.1);padding:25px 20px;width:100%;max-width:420px;box-sizing:border-box}
    h1{display:flex;align-items:center;justify-content:center;gap:8px;font-size:1.4rem;margin-bottom:20px}
    h1 img{width:28px;height:28px}
    label{font-weight:600;display:block;margin:15px 0 6px}
    input,select,button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #ccc;font-size:1rem;box-sizing:border-box}
    .row{display:flex;gap:10px}
    button{border:none;color:#fff;font-weight:600;cursor:pointer;transition:opacity .2s}
    button:hover{opacity:.9}
    .blue{background:linear-gradient(90deg,#007bff,#00aaff)}
    .gray{background:#ccc;color:#000}
    .muted{color:#666;font-size:.95rem;text-align:center;margin-top:10px}
    #status{display:none;text-align:center;color:#0a0;font-weight:600;margin-top:10px}
    #error{color:#e00;font-weight:500;margin:8px 0;text-align:center}
    .section{margin-top:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .list{margin-top:10px;border:1px solid #e5e5e5;border-radius:12px;padding:10px;max-height:280px;overflow:auto}
    .item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f1f1f1}
    .item:last-child{border-bottom:none}
  </style>
</head>
<body>
  <div class="app">
    <h1><img src="Icon-192.png" alt="icon"> Ventsharm Budget</h1>

    <!-- Auth / header actions (placeholder; hook up to Firebase as in your saved build) -->
    <div class="row">
      <button id="loginBtn" class="blue">Login / Register</button>
      <button id="logoutBtn" class="gray">Logout</button>
    </div>
    <div id="status">✅ Signed in</div>
    <div id="error"></div>

    <!-- Quick add -->
    <div class="section">
      <label>Add entry</label>
      <div class="grid">
        <input id="title" placeholder="Title (e.g. Salary, Rent)" />
        <input id="amount" type="number" placeholder="Amount" />
      </div>
      <div class="grid" style="margin-top:10px">
        <select id="type">
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>
        <button id="add" class="blue">Add</button>
      </div>
    </div>

    <!-- Overview -->
    <div class="section">
      <label>Overview</label>
      <div class="grid">
        <input id="totalIncome" disabled placeholder="Total income: 0" />
        <input id="totalExpense" disabled placeholder="Total expense: 0" />
      </div>
      <div class="grid" style="margin-top:10px">
        <input id="available" disabled placeholder="Available: 0" />
        <button id="reset" class="gray">Reset (local)</button>
      </div>
    </div>

    <!-- Lists -->
    <div class="section">
      <label>Entries</label>
      <div class="list" id="list"></div>
    </div>

    <p class="muted">Data can sync with Firebase (use your saved build). This version is isolated to <code>/Socialcreator-manifest/</code> so it won’t merge with other PWAs.</p>
  </div>

  <script>
    // --- Minimal local-only logic (safe placeholder) ---
    const $ = s => document.querySelector(s);
    const listEl = $("#list"), err = $("#error"), statusEl = $("#status");
    const storeKey = "vb_budget_local_v1";
    let entries = JSON.parse(localStorage.getItem(storeKey) || "[]");

    function fmt(n){ return Number(n||0).toLocaleString(undefined,{maximumFractionDigits:2}); }
    function render(){
      listEl.innerHTML = "";
      let inc=0, exp=0;
      entries.forEach((e,i)=>{
        if(e.type==="income") inc += Number(e.amount||0);
        else exp += Number(e.amount||0);
        const row = document.createElement("div");
        row.className = "item";
        row.innerHTML = `
          <div>${e.title || "(untitled)"} — <strong>${e.type}</strong></div>
          <div>
            £${fmt(e.amount)}
            <button data-i="${i}" class="del" style="margin-left:12px;background:#eee;color:#000;border:1px solid #ddd;border-radius:8px;padding:4px 8px">Delete</button>
          </div>`;
        listEl.appendChild(row);
      });
      $("#totalIncome").value = `Total income: £${fmt(inc)}`;
      $("#totalExpense").value = `Total expense: £${fmt(exp)}`;
      $("#available").value   = `Available: £${fmt(inc - exp)}`;
      localStorage.setItem(storeKey, JSON.stringify(entries));
      listEl.querySelectorAll(".del").forEach(b=>{
        b.onclick = () => { entries.splice(Number(b.dataset.i),1); render(); };
      });
    }
    render();

    $("#add").onclick = () => {
      const title = $("#title").value.trim();
      const amount = Number($("#amount").value);
      const type = $("#type").value;
      if(!title || !amount){ err.textContent = "Please enter a title and amount."; return; }
      err.textContent = "";
      entries.push({ title, amount, type, ts: Date.now() });
      $("#title").value = ""; $("#amount").value = "";
      render();
    };

    $("#reset").onclick = () => {
      if(confirm("Clear local entries?")) { entries = []; render(); }
    };

    // Placeholder auth UI — replace with your saved Firebase logic
    $("#loginBtn").onclick = () => { statusEl.style.display = "block"; statusEl.textContent = "✅ Signed in (placeholder)"; };
    $("#logoutBtn").onclick = () => { statusEl.style.display = "none"; };

  </script>

  <!-- Scoped Service Worker just for /Socialcreator-manifest/ -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker
        .register('/Socialcreator-manifest/service-worker.js', { scope: '/Socialcreator-manifest/' })
        .then(() => console.log('✅ Budget SW registered (scoped)'))
        .catch(err => console.error('SW registration failed:', err));
    }
  </script>
</body>
</html>
