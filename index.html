<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Ventsharm Budget</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#000000">
<link rel="icon" href="Icon-192.png">
<style>
:root {--bg:#f5f6f8;--card:#fff;--text:#111;--b:#e5e7eb;--pri:#0d6efd;}
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif}
body{background:var(--bg);color:var(--text);display:flex;align-items:center;justify-content:center;min-height:100vh;padding:10px}
.card{background:var(--card);border-radius:18px;box-shadow:0 4px 18px rgba(0,0,0,.1);padding:24px;max-width:420px;width:100%;}
h1{display:flex;align-items:center;gap:8px;justify-content:center;font-size:1.4rem;margin-bottom:20px}
h1 img{width:28px;height:28px}
input,select,button{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #ccc;font-size:1rem;margin-top:10px}
button{cursor:pointer;font-weight:600}
.btn{background:linear-gradient(90deg,#007bff,#00aaff);border:none;color:#fff}
.btn.gray{background:#ccc;color:#000}
.note{text-align:center;margin-top:10px;font-size:.9rem;color:#666}
.tabs{display:flex;gap:6px;margin-bottom:10px}
.tab{flex:1;text-align:center;padding:8px;border:1px solid #ccc;border-radius:10px;cursor:pointer}
.tab.active{background:#eef6ff;border-color:#b6dbff;color:#064d96}
.list{border:1px solid #ddd;border-radius:10px;margin-top:10px}
.row{display:grid;grid-template-columns:1fr auto auto;gap:6px;padding:8px 10px;border-bottom:1px solid #eee;align-items:center}
.row:last-child{border-bottom:none}
.money{font-weight:700}
.hidden{display:none}
</style>
</head>
<body>

<div id="loginCard" class="card">
  <h1><img src="Icon-192.png" alt=""> Ventsharm Budget</h1>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="loginBtn" class="btn">Login / Register</button>
  <p id="loginMsg" class="note"></p>
</div>

<div id="appCard" class="card hidden">
  <h1><img src="Icon-192.png" alt=""> Ventsharm Budget</h1>
  <div style="text-align:right;margin-bottom:10px">
    <button id="logoutBtn" class="btn gray">Logout</button>
  </div>

  <div class="tabs">
    <div class="tab active" data-tab="inc">Incomes</div>
    <div class="tab" data-tab="exp">Expenses</div>
    <div class="tab" data-tab="ov">Overview</div>
  </div>

  <input id="title" placeholder="Title (e.g. Salary, Rent)">
  <input id="amount" type="number" placeholder="Amount">
  <select id="kind">
    <option value="income">Income</option>
    <option value="expense">Expense</option>
  </select>
  <button id="addBtn" class="btn" style="margin-top:10px">Add</button>

  <div id="pane-inc" class="list"></div>
  <div id="pane-exp" class="list hidden"></div>
  <div id="pane-ov" class="hidden note"></div>
  <p class="note">Synced via Firebase / Cached offline</p>
</div>

<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import {getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, setPersistence, browserLocalPersistence} from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
import {getFirestore, collection, doc, setDoc, getDocs, deleteDoc} from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

const app = initializeApp({
 apiKey:"AIzaSyCdqBDusmELyZ6S6OeiUX_I_POjydy-dN4",
 authDomain:"budget-app-283de.firebaseapp.com",
 projectId:"budget-app-283de",
 storageBucket:"budget-app-283de.firebasestorage.app",
 messagingSenderId:"162369707369",
 appId:"1:162369707369:web:3faa7f002f8ba22dc0f1f8"
});
const auth = getAuth(app);const db = getFirestore(app);
await setPersistence(auth,browserLocalPersistence);

const $=s=>document.querySelector(s);
const loginCard=$("#loginCard"),appCard=$("#appCard"),loginBtn=$("#loginBtn"),logoutBtn=$("#logoutBtn"),loginMsg=$("#loginMsg");
const tabs=document.querySelectorAll(".tab"),panes={inc:$("#pane-inc"),exp:$("#pane-exp"),ov:$("#pane-ov")};
const title=$("#title"),amount=$("#amount"),kind=$("#kind");
const LS="budget_cache_v1";let cache=JSON.parse(localStorage.getItem(LS)||'{"entries":[],"uid":null}');let uid=cache.uid;
function saveCache(){localStorage.setItem(LS,JSON.stringify(cache));}
function fmt(n){return Number(n||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});}
function render(){const inc=cache.entries.filter(e=>e.kind==="income"),exp=cache.entries.filter(e=>e.kind==="expense");
const incSum=inc.reduce((a,b)=>a+Number(b.amount||0),0),expSum=exp.reduce((a,b)=>a+Number(b.amount||0),0);
const avail=incSum-expSum;$("#pane-ov").innerHTML=`Total Income: £${fmt(incSum)}<br>Total Expense: £${fmt(expSum)}<br><b>Available: £${fmt(avail)}</b>`;
$("#pane-inc").innerHTML="";inc.forEach(e=>$("#pane-inc").append(row(e)));
$("#pane-exp").innerHTML="";exp.forEach(e=>$("#pane-exp").append(row(e)));}

function row(e){const d=document.createElement("div");d.className="row";
d.innerHTML=`<div>${e.title}</div><div class="money">£${fmt(e.amount)}</div>
<div><button data-a="d" class="btn gray" style="padding:6px 10px">Del</button></div>`;
d.querySelector("[data-a='d']").onclick=()=>del(e.id);return d;}

tabs.forEach(t=>t.onclick=()=>{tabs.forEach(x=>x.classList.remove("active"));t.classList.add("active");
Object.keys(panes).forEach(p=>panes[p].classList.add("hidden"));panes[t.dataset.tab].classList.remove("hidden");});

$("#addBtn").onclick=async()=>{if(!title.value||!amount.value)return;
const id=crypto.randomUUID(),e={id,title:title.value,amount:Number(amount.value),kind:kind.value,ts:Date.now()};
cache.entries.push(e);saveCache();render();title.value="";amount.value="";if(uid)await setDoc(doc(db,"budgets",uid,"entries",id),e);};

async function del(id){cache.entries=cache.entries.filter(x=>x.id!==id);saveCache();render();if(uid)await deleteDoc(doc(db,"budgets",uid,"entries",id));}

loginBtn.onclick=async()=>{const email=$("#email").value,pass=$("#password").value;
if(!email||!pass){loginMsg.textContent="Enter email & password";return;}
try{await signInWithEmailAndPassword(auth,email,pass);}catch{await createUserWithEmailAndPassword(auth,email,pass);}};

logoutBtn.onclick=()=>signOut(auth);

onAuthStateChanged(auth,async u=>{
 uid=u?.uid||null;
 if(uid){
  loginCard.classList.add("hidden");
  appCard.classList.remove("hidden");
  const q=await getDocs(collection(db,"budgets",uid,"entries"));
  cache.entries=q.docs.map(d=>d.data());cache.uid=uid;saveCache();render();
 }else{
  appCard.classList.add("hidden");
  loginCard.classList.remove("hidden");
 }
});
render();
</script>

<script>
if('serviceWorker'in navigator){
 navigator.serviceWorker.register('/Socialcreator-manifest/service-worker.js',{scope:'/Socialcreator-manifest/'});
}
</script>
</body>
</html>
