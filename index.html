<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget Planner</title>
<link rel="manifest" href="manifest.webmanifest">
<link rel="icon" href="Icon-192.png">
<meta name="theme-color" content="#ffffff">
<style>
body {
  margin: 0;
  font-family: system-ui, sans-serif;
  background: #f5f6f8;
  color: #222;
}
header {
  background: #fff;
  border-bottom: 1px solid #ddd;
  padding: 12px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
header h1 { margin: 0; font-size: 1.2rem; }
.btn-logout {
  background: none;
  border: 1px solid #000;
  color: #000;
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}
.btn-logout:hover {
  background: #000;
  color: #fff;
}
.container {
  max-width: 480px;
  margin: 30px auto;
  background: #fff;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,.08);
}
.tabs {
  display: flex;
  justify-content: space-around;
  border-bottom: 1px solid #ddd;
  margin-bottom: 16px;
}
.tabs button {
  flex: 1;
  padding: 10px;
  border: none;
  background: #f0f0f0;
  cursor: pointer;
  font-weight: 600;
}
.tabs button.active {
  background: #000;
  color: #fff;
}
.section { display: none; }
.section.active { display: block; }

.card {
  background: #fafafa;
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 10px;
}
button, input {
  border-radius: 8px;
  border: 1px solid #000;
  padding: 8px 10px;
  font-size: 1rem;
}
button {
  background: #fff;
  color: #000;
  cursor: pointer;
  font-weight: 600;
}
button:hover { background: #000; color: #fff; }
input { width: 100%; margin-bottom: 8px; }

.total-card {
  background: #f2f5ff;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
  margin-bottom: 10px;
  font-weight: 600;
}
.hidden { display: none; }

/* Login/Register screen */
.auth-screen {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
  background: #fff;
  text-align: center;
}
.auth-screen form {
  background: #fff;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,.1);
  width: 90%;
  max-width: 340px;
}
.auth-screen input { margin: 10px 0; width: 100%; }
.auth-links button {
  border: none;
  background: none;
  color: #007bff;
  text-decoration: underline;
  cursor: pointer;
}
</style>
</head>
<body>

<!-- Login/Register -->
<div id="authSection" class="auth-screen">
  <form id="loginForm">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email" required>
    <input type="password" id="loginPass" placeholder="Password" required>
    <button type="submit">Login</button>
    <div class="auth-links">
      <button type="button" id="toRegister">Create account</button> |
      <button type="button" id="toForgot">Forgot password?</button>
    </div>
  </form>

  <form id="registerForm" class="hidden">
    <h2>Register</h2>
    <input type="email" id="regEmail" placeholder="Email" required>
    <input type="password" id="regPass" placeholder="Password" required>
    <button type="submit">Register</button>
    <p id="verifyMsg" style="display:none;color:green;">‚úÖ Please verify your email before logging in.</p>
    <div class="auth-links">
      <button type="button" id="toLogin1">Back to login</button>
    </div>
  </form>

  <form id="forgotForm" class="hidden">
    <h2>Reset Password</h2>
    <input type="email" id="forgotEmail" placeholder="Email" required>
    <button type="submit">Send Reset Email</button>
    <div class="auth-links">
      <button type="button" id="toLogin2">Back to login</button>
    </div>
  </form>
</div>

<!-- Main App -->
<div id="appSection" class="hidden">
  <header>
    <h1>Budget Planner</h1>
    <button id="btnLogout" class="btn-logout">Logout</button>
  </header>

  <div class="container">
    <div class="tabs">
      <button class="tab active" data-tab="incomes">Incomes</button>
      <button class="tab" data-tab="expenses">Expenses</button>
      <button class="tab" data-tab="overview">Overview</button>
    </div>

    <div id="incomes" class="section active">
      <h3>Add Income</h3>
      <input id="incName" placeholder="Source">
      <input id="incAmount" type="number" placeholder="Amount">
      <button id="addIncome">Add</button>
      <div id="incomeList"></div>
    </div>

    <div id="expenses" class="section">
      <h3>Add Expense</h3>
      <input id="expName" placeholder="Item">
      <input id="expAmount" type="number" placeholder="Cost">
      <button id="addExpense">Add</button>
      <div id="expenseList"></div>
    </div>

    <div id="overview" class="section">
      <div class="total-card">üí∞ Total Income: <span id="totalIncome">0</span></div>
      <div class="total-card">üõçÔ∏è Total Expenses: <span id="totalExpenses">0</span></div>
      <div class="total-card">‚úÖ Available: <span id="availableBalance">0</span></div>
      <button id="deleteAccount" style="margin-top:10px;border:1px solid red;color:red;">Delete Account</button>
    </div>
  </div>
</div>

<!-- Firebase & App Script -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, sendEmailVerification, signOut, deleteUser } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCdqBDusmELyZ6S6OeiUX_I_POjydy-dN4",
  authDomain: "budget-app-283de.firebaseapp.com",
  projectId: "budget-app-283de",
  storageBucket: "budget-app-283de.firebasestorage.app",
  messagingSenderId: "162369707369",
  appId: "1:162369707369:web:3faa7f002f8ba22dc0f1f8"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const authSection=document.getElementById("authSection");
const appSection=document.getElementById("appSection");
const verifyMsg=document.getElementById("verifyMsg");

document.getElementById("toRegister").onclick=()=>{loginForm.classList.add("hidden");registerForm.classList.remove("hidden");};
document.getElementById("toForgot").onclick=()=>{loginForm.classList.add("hidden");forgotForm.classList.remove("hidden");};
document.getElementById("toLogin1").onclick=()=>{registerForm.classList.add("hidden");loginForm.classList.remove("hidden");};
document.getElementById("toLogin2").onclick=()=>{forgotForm.classList.add("hidden");loginForm.classList.remove("hidden");};

registerForm.onsubmit=async e=>{
  e.preventDefault();
  const email=regEmail.value,pass=regPass.value;
  try {
    const cred=await createUserWithEmailAndPassword(auth,email,pass);
    await sendEmailVerification(cred.user);
    verifyMsg.style.display="block";
  } catch(err){ alert(err.message); }
};

loginForm.onsubmit=async e=>{
  e.preventDefault();
  try {
    await signInWithEmailAndPassword(auth,loginEmail.value,loginPass.value);
  } catch(err){ alert(err.message); }
};

forgotForm.onsubmit=async e=>{
  e.preventDefault();
  try {
    await sendPasswordResetEmail(auth,forgotEmail.value);
    alert("Reset email sent.");
  } catch(err){ alert(err.message); }
};

onAuthStateChanged(auth, user=>{
  if(user){
    authSection.classList.add("hidden");
    appSection.classList.remove("hidden");
  } else {
    appSection.classList.add("hidden");
    authSection.classList.remove("hidden");
  }
});

btnLogout.onclick=()=>signOut(auth);
deleteAccount.onclick=async()=>{
  if(confirm("Are you sure? This will permanently delete your account.")){
    await deleteUser(auth.currentUser);
  }
};

// Tabs
document.querySelectorAll(".tab").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    document.getElementById(btn.dataset.tab).classList.add("active");
  };
});
</script>

<script>
if("serviceWorker" in navigator)
  navigator.serviceWorker.register("service-worker.js");
</script>
</body>
</html>
